@model ContentModel

@{
    ViewData["Title"] = "Home Page";
}

<script src="~/lib/jquery/dist/jquery.js"></script>

<style>

    body {
    background-color:black;
    opacity:0.7;
    color:darkgray;
    }


    .box {
        width: 100px;
        height: 100px;
        margin: 20px;
    }

    .card-img-top {
        position: relative;
        border: 3px solid #ff6703;
        padding:5px;
        /*background-color:dodgerblue;*/
    }

    .boxSelected {
        border: 3px solid #F1F13A;
    }

    #dragtarget img {
        margin-top: 10px;
        margin-bottom: 10px;
    }

    .selectedbox {
        background-color: gainsboro;
        opacity: 0.4;
        border:5px solid #ff6703;
    }

    .jdisplay {
        padding: 10px;
    }


    #JsonLink {
        overflow-wrap: break-word;
        word-wrap: break-word;
        hyphens: auto;
    }

    .jdisplay ul {
        list-style-type: none;
    }
</style>


<script>

    function drag(event) {
        event.dataTransfer.setData("text", event.target.id);
    };

    function drop(event) {
        event.preventDefault();
        var widgetName2 = event.dataTransfer.getData("text");
        var elem = document.getElementById(widgetName2);
        elem.classList.remove("box");
        elem.classList.add("boxSelected");
        //elem.attributes.item("draggable").remove();
        //elem.attributes.item("ondragstart").remove();

        event.target.appendChild(document.getElementById(widgetName2));
        var selectedIds = [];
        $("#dragtarget img").each(function () {
            selectedIds.push(this.id);
        });

        var select = btoa(selectedIds.join());

        $.ajax({
            url: 'Home/AddToSelectionList',
            data: {
                filename: widgetName2,
                selectedFiles: selectedIds.join()
            }
        }).done(function () {
            $("#dragtarget").removeClass("selectedbox");

            $.getJSON('/api/getselection/' + select,
                function (result) {

                    var res = "";
                    if (result != null) {
                        if (result.myJson.length > 0) {
                            res += "<ul><strong>myJson</strong>";
                            $.each(result.myJson, function (i, item) {
                                res += "<li><ul>";
                                res += "<li>title: " + item.title + "</li>";
                                res += "<li>lengthKb: " + item.lengthKb + "</li>";
                                res += "<li>lengthMb: " + item.lengthMb + "</li>";
                                res += "<li>url: " + item.url + "</li>";
                                res += "</ul></li>";
                                res += "<br/>";
                            });
                            res += "</ul>";
                        }

                        res += "<ul><strong>stat</strong>";
                        res += "<li>count: " + result.stat.count + "</li>";
                        res += "<li>totalLengthKb: " + result.stat.totalLengthKb + "</li>";
                        res += "<li>totalLengthMb: " + result.stat.totalLengthMb + "</li>";
                        res += "<li>elapsedTime: " + result.stat.elapsedTime.toFixed(10) + "s </li>";
                        res += "</ul>";
                    }

                    $("#JsonLinkLabel").text("Generated link:");
                    $("#JsonPreviewLabel").text("Generated Json content:");
                    $("#JsonPreview").html(res);
                    $("#JsonLink").html(window.location.protocol + "//" + window.location.host + "/api/getselection/" + select);
                    $("#JsonLink").show();
                    $("#JsonPreview").show();
                });
        });
    };

    function allowDrop(ev) {
        ev.preventDefault();
        $("#dragtarget").addClass("selectedbox");

    };

    function removeDrop(event) {
        event.preventDefault();
        $("#dragtarget").removeClass("selectedbox");
    };

    $(document).ready(function () {
        $("#JsonLink").hide();
        $("#JsonPreview").hide();
    });
</script>

<div class="container">
    <div class="row">
        <div class="col-10">
            <p>Your images</p>
        </div>
        <div class="col-2">
            <p>Your selection</p>
        </div>
    </div>

    <div class="row">
        <div class="col-10 d-flex flex-row border flex-wrap">
            @foreach (var file in Model.UnselectedFiles)
            {
                <img class="box card-img-top" src="@Url.Content(file.Path)" alt="@file.Name" id="@file.Name" draggable="true" ondragstart="drag(event)">
            }
        </div>
        <div class="col-2 border" ondrop="drop(event)" ondragover="allowDrop(event)" id="dragtarget" ondragleave="removeDrop(event)">
            @if (Model.SelectedFiles != null)
            {
                @foreach (var file in Model.SelectedFiles)
                {
                    <img class="box card-img-top" src="@Url.Content(file.Path)" alt="@file.Name" id="@file.Name">
                }
            }
        </div>
    </div>
    <br />
    <br />
    <p id="JsonLinkLabel"></p>
    <div class="row border jdisplay" id="JsonLink"></div>
    <br />
    <br />
    <br />
    <br />
    <p id="JsonPreviewLabel"></p>
    <div class="row border jdisplay" id="JsonPreview"></div>
</div>
